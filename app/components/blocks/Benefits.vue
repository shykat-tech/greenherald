<template>
  <section id="benefits" ref="benefitsRef">
    <div class="container" ref="mainContainerRef">
      <h2 class="font-heading b-title">
        What&apos;s waiting for you <br />
        when you reconnect
      </h2>

      <div class="blocks">
        <div class="block">
          <h3>
            Global <br />
            Connections
          </h3>
          <span>Link up with alumni around the world for <br />
            friendship, mentorship, and professional growth.</span>
        </div>

        <div class="block">
          <h3>
            Opportunities & <br />
            Mentorship
          </h3>
          <span>
            Link up with alumni around the world for <br />
            friendship, mentorship, and professional growth.</span>
        </div>

        <div class="block">
          <h3>
            Give Back to the <br />
            School
          </h3>
          <span>Link up with alumni around the world for <br />
            friendship, mentorship, and professional growth.</span>
        </div>

        <div class="block circleBlock" ref="circleBlockRef">
          <div class="circle"></div>

          <h3>
            Simple to
            <br />
            Join
          </h3>
          <span>Link up with alumni around the world for <br />
            friendship, mentorship, and professional growth.</span>
        </div>
      </div>
    </div>

    <section id="dup-benefits" ref="dupBenefitsRef">
      <div class="dup-container">
        <h2 class="font-heading b-title">
          What&apos;s waiting for you <br />
          when you reconnect
        </h2>

        <div class="blocks">
          <div class="block remove-block">
            <h3>
              Global <br />
              Connections
            </h3>
            <span>Link up with alumni around the world for <br />
              friendship, mentorship, and professional growth.</span>
          </div>

          <div class="block remove-block">
            <h3>
              Opportunities & <br />
              Mentorship
            </h3>
            <span>
              Link up with alumni around the world for <br />
              friendship, mentorship, and professional growth.</span>
          </div>

          <div class="block remove-block">
            <h3>
              Give Back to the <br />
              School
            </h3>
            <span>Link up with alumni around the world for <br />
              friendship, mentorship, and professional growth.</span>
          </div>

          <div class="block titleBlock" ref="titleBlockRef">
            <div class="circle"></div>

            <h3 class="next-title" ref="nextTitleRef">
              <span class="line line-1" ref="line1">Simple to</span><br />
              <span class="line line-2" ref="line2">Join</span>
            </h3>
            <span class="sub-title" ref="subTitleRef">Link up with alumni around the world for <br />
              friendship, mentorship, and professional growth.</span>
          </div>
        </div>
      </div>

      <div class="hidden-title">
        <h2 class="heading" ref="headingTitleRef">Simple to Join</h2>
      </div>

      <div class="steps" ref="stepsRef">
        <div class="step">
          <div class="count">
            <img src="/assets/images/steps/step1.png" alt="step1" />
            <span class="step-count">1</span>
          </div>
          <div class="step-desc">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M40 24C40 19.5817 36.4184 16 32 16C27.5816 16 24 19.5817 24 24C24 28.4184 27.5816 32 32 32C36.4184 32 40 28.4184 40 24Z"
                stroke="#A2895B" stroke-width="3.2" stroke-linecap="round" stroke-linejoin="round" />
              <path
                d="M58.6654 32.0003C58.6654 17.2727 46.7262 5.33362 31.9987 5.33362C17.2711 5.33362 5.33203 17.2727 5.33203 32.0003C5.33203 46.7277 17.2711 58.6669 31.9987 58.6669C46.7262 58.6669 58.6654 46.7277 58.6654 32.0003Z"
                stroke="#A2895B" stroke-width="3.2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M45.3346 45.3333C45.3346 37.9696 39.365 32 32.0013 32C24.6375 32 18.668 37.9696 18.668 45.3333"
                stroke="#A2895B" stroke-width="3.2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>

            <div>
              <h3>Sign Up Online</h3>
              <span>Fill out your alumni details and choose a membership package
                (Yearly or Lifetime).</span>
            </div>
          </div>
        </div>

        <div class="step">
          <div class="count">
            <img src="/assets/images/steps/step2.png" alt="step2" />
            <span class="step-count">2</span>
          </div>
          <div class="step-desc">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M50.64 50.6667H50.6654M50.64 50.6667C48.9795 52.3133 45.9702 51.9032 43.8598 51.9032C41.2694 51.9032 40.0219 52.4099 38.1731 54.2587C36.599 55.8331 34.4886 58.6667 31.9987 58.6667C29.5088 58.6667 27.3984 55.8331 25.8242 54.2587C23.9754 52.4099 22.728 51.9032 20.1375 51.9032C18.0272 51.9032 15.0178 52.3133 13.3573 50.6667C11.6835 49.0069 12.0954 45.9851 12.0954 43.8611C12.0954 41.1771 11.5085 39.9429 9.59704 38.0315C6.75374 35.1883 5.33208 33.7664 5.33203 32C5.33206 30.2333 6.75368 28.8117 9.59696 25.9685C11.3032 24.2622 12.0954 22.5714 12.0954 20.1388C12.0954 18.0284 11.6853 15.019 13.332 13.3585C14.9918 11.6848 18.0136 12.0967 20.1376 12.0967C22.5701 12.0967 24.2609 11.3045 25.9671 9.59833C28.8104 6.755 30.232 5.33334 31.9987 5.33334C33.7654 5.33334 35.187 6.755 38.0302 9.59833C39.736 11.3042 41.4267 12.0967 43.8598 12.0967C45.9702 12.0967 48.9798 11.6866 50.6403 13.3333C52.3139 14.9932 51.9019 18.0149 51.9019 20.1388C51.9019 22.8229 52.4891 24.057 54.4003 25.9685C57.2438 28.8117 58.6654 30.2333 58.6654 32C58.6654 33.7664 57.2438 35.1883 54.4003 38.0315C52.4888 39.9429 51.9019 41.1771 51.9019 43.8611C51.9019 45.9851 52.3139 49.0069 50.64 50.6667Z"
                stroke="#A2895B" stroke-width="4" />
              <path d="M24 34.381C24 34.381 27.2 36.1192 28.8 38.6666C28.8 38.6666 33.6 28.6666 40 25.3333"
                stroke="#A2895B" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <div>
              <h3>Verify Your Information</h3>
              <span>We&apos;ll confirm your graduation details for secure
                access.</span>
            </div>
          </div>
        </div>

        <div class="step">
          <div class="count">
            <img src="/assets/images/steps/step3.png" alt="step3" />
            <span class="step-count">3</span>
          </div>
          <div class="step-desc">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M37.3346 22.6668C37.3346 15.303 31.365 9.3335 24.0013 9.3335C16.6375 9.3335 10.668 15.303 10.668 22.6668C10.668 30.0306 16.6375 36.0002 24.0013 36.0002C31.365 36.0002 37.3346 30.0306 37.3346 22.6668Z"
                stroke="#A2895B" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M42.6654 54.6667C42.6654 44.3573 34.308 36 23.9987 36C13.6894 36 5.33203 44.3573 5.33203 54.6667"
                stroke="#A2895B" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
              <path
                d="M42.668 33.0477C42.668 33.0477 45.868 34.7859 47.468 37.3333C47.468 37.3333 52.268 27.3333 58.668 24"
                stroke="#A2895B" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" />
            </svg>

            <div>
              <h3>Become a Member</h3>
              <span>Start enjoying all the benefits: events, connections, and
                community updates.</span>
            </div>
          </div>
        </div>

        <div class="steps-line">
          <div class="back-line">
            <div class="progress" ref="progressRef" />
          </div>
        </div>

        <div class="steps-line-count">
          <span class="step--count">1</span>
          <span class="step--count">2</span>
          <span class="step--count">3</span>
        </div>
      </div>
    </section>
  </section>
</template>

<script setup>
import { ref } from "vue";
const { $gsap } = useNuxtApp();

const headingTitleRef = ref(null);
const nextTitleRef = ref(null);
const line1 = ref(null);
const line2 = ref(null);
const progressRef = ref(null);
const stepsRef = ref(null);
const mainContainerRef = ref(null);
const benefitsRef = ref(null);
const dupBenefitsRef = ref(null);
const titleBlockRef = ref(null);
const circleBlockRef = ref(null);
const subTitleRef = ref(null);

// const stepDesc = $gsap.utils.toArray(".step-desc");

const scrollDir = ref("down");

const headingPos = {
  x: 0,
  y: 0,
};

const count = ref(0);

onMounted(() => {


  const counts = $gsap.utils.toArray(".step-count");
  const mCounts = $gsap.utils.toArray(".step--count");

  const mm = $gsap.matchMedia();

  mm.add(
    {
      isMobile: "(max-width: 480px)",
      isTablet: "(min-width: 481px) and (max-width: 768px)",
      isDesktop: "(min-width: 769px)",
    },
    (context) => {
      const pos = headingTitleRef.value.getBoundingClientRect();
      const nxtPos = nextTitleRef.value.getBoundingClientRect();

      const line1Width = line1.value.getBoundingClientRect().width;

      headingPos.x = nxtPos.x - pos.x;
      headingPos.y = nxtPos.y - pos.y;


      const { isMobile, isDesktop } = context.conditions;

      const line2TL = $gsap.timeline({ paused: true });

      line2TL.to(".line-2", {
        y: "-100%",
        x: isDesktop && `${line1Width * (64 / 40) + 10}px`,
        duration: 0.4,
        ease: "power2.out",
      });

      const tl = $gsap.timeline({
        scrollTrigger: {
          trigger: benefitsRef.value,
          start: "top top",
          // end: isMobile ? "+=100%" : "+=350%",
          // scrub: true,
          pin: true,
          toggleActions: "play none none reverse",
          onUpdate: (self) => {
            if (self.direction === 1) scrollDir.value = "down";
            else scrollDir.value = "up";
          },
        },
      });

      tl.to(dupBenefitsRef.value, { clipPath: isMobile ? "circle(12% at 15% 80%)" : "circle(12% at 75% 65%)" })
        .to(circleBlockRef.value, {
          opacity: 0,
          x: isMobile ? "0px" : "500px",
        })
        .to(mainContainerRef.value, { x: isDesktop && "-180%", y: isMobile && "-40%" }, "<")
        .to(
          dupBenefitsRef.value,
          {
            clipPath: isMobile ? "circle(75% at 43% 50%)" : "circle(85% at 43% 50%)",
          },
          "<"
        )
        .to(subTitleRef.value, { opacity: 0, duration: 0.3 }, "<")
        .to(
          titleBlockRef.value,
          {
            x: isMobile ? Math.abs(headingPos.x) : `-${headingPos.x}px`,
            y: `-${headingPos.y}px`,
            duration: 1,
          },
          "<"
        )
        .to([line1.value, line2.value], { duration: 0.4 }, "<")
        .fromTo(
          stepsRef.value,
          { x: "110%" },
          { x: "95%" },
        );

      const tl2 = $gsap.timeline({
        scrollTrigger: {
          trigger: stepsRef.value,
          start: "-10% top",
          scrub: true,
          onUpdate(self) {
            const pg = Math.floor((self.progress * 10) / counts.length)
            if (pg === 3) {
              count.value = 2;
            } else if (pg >= 1 && pg < 3) {
              count.value = 1;
            } else {
              count.value = 0;
            }
          }
        },
      });

      tl2.fromTo(stepsRef.value, { x: "95%" }, { x: "0%" })
        .to(
          progressRef.value,
          {
            width: "100%",
            duration: 0.5,
            onUpdate() {
              if (scrollDir.value === "down") {
                $gsap.to([counts.slice(0, count.value + 1), mCounts.slice(0, count.value + 1)], {
                  color: "white",
                  background: "#7E6B47",
                });
              } else {
                $gsap.to([counts.slice(count.value + 1), mCounts.slice(count.value + 1)], {
                  color: "black",
                  background: "#E7DFCF",
                });
              }
            },
          },
          ""
        );

      $gsap.to(line2.value, {
        y: "-100%",
        x: `${line1Width}px`,
        duration: 0.3,
        ease: "power2.out",
        scrollTrigger: {
          trigger: line2.value,
          start: "top 55%",
          toggleActions: "play reverse play reverse",
          scrub: false,
          containerAnimation: tl,
        },
      });
    })


});
</script>

<style scoped lang="scss">
#benefits,
#dup-benefits {
  width: 100vw;
  @include clamp-property("padding-inline", 1.25, 8.25);
  @include clamp-property("padding-block", 6.25, 15.62);
  min-height: 100vh;
  background: url("/assets/images/benefit_BG.png");
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center;
  overflow: hidden;
  @include flex-center;
  position: relative;

  .container,
  .dup-container {
    width: 100%;

    .b-title {
      @include clamp-property("font-size", 2.125, 4.5);
      line-height: 110%;
      @include clamp-property("margin-bottom", 5, 15.87);
      color: white;
    }

    .blocks {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      align-items: start;
      flex-wrap: wrap;
      @include clamp-property("gap", 2.5, 5);


      .block {
        h3 {
          font-weight: 500;
          line-height: 120%;
          @include clamp-property("font-size", 1.5, 2.5);
          color: #fcfcfc;
          margin-bottom: 20px;
          text-wrap: nowrap;
          position: relative;
        }

        span {
          font-weight: 400;
          @include clamp-property("font-size", 0.875, 1);
          color: #e0e0e0;
          display: inline-block;
          position: relative;
        }
      }

      @media screen and (max-width: 768px) {
        grid-template-columns: repeat(1, 1fr);

        .block {
          br {
            display: none;
          }
        }
      }

      @media screen and (min-width: 481px) and (max-width: 1024px) {
        grid-template-columns: repeat(2, 1fr);

      }
    }
  }
}

#dup-benefits {
  .b-title {
    opacity: 0;
  }

  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 50;
  transform: translate(-50%, -50%);
  background: #f7f5f0;
  clip-path: circle(0% at 80% 62%);

  @media screen and (max-width: 480px) {
    clip-path: circle(0% at 10% 80%);
  }

  @media screen and (min-width: 481px) and (max-width: 1024px) {
    clip-path: circle(0% at 65% 65%);
  }

  .dup-container {
    .blocks {
      .block {
        opacity: 0;
      }

      .titleBlock {
        opacity: 1;

        .next-title {
          span {
            display: inline-block;
            position: relative;
            font-size: 4rem;
            line-height: 1.1;
            font-weight: 600;
            color: #08110b;

            .line {
              display: block;
              white-space: nowrap;
            }

            .line-1 {
              transform: translateY(0);
            }

            .line-2 {
              transform: translateY(0);
            }
          }

          @media screen and (max-width: 480px) {
            .line-2 {
              margin-left: 5px;
            }
          }

          @media screen and (max-width: 768px) {
            span {
              font-size: 2rem;
            }

            .line-2 {
              margin-left: 8px;
            }
          }

          @media screen and (min-width: 769px) and (max-width: 2560px) {
            span {
              font-size: 3rem;
            }

            .line-2 {
              margin-left: 5px;
            }
          }

          @media screen and (min-width: 2561px) {
            .line-2 {
              margin-left: 6px;
            }
          }
        }

        span {
          color: #5e5e5e;
        }
      }
    }
  }

  .heading {
    font-size: 4rem;
    line-height: 120%;
    letter-spacing: -1%;
    font-weight: 500;
    margin-bottom: 80px;
    text-align: center;
    position: absolute;
    z-index: 50;
    top: 15%;
    left: 50%;
    transform: translateX(-50%);

    opacity: 0;

    @media screen and (max-width: 768px) {
      top: 10%;
      text-wrap: nowrap;
      font-size: 2rem;
    }

    @media screen and (min-width: 769px) and (max-width: 2560px) {
      top: 7%;
      text-wrap: nowrap;
      font-size: 3rem;
    }
  }

  .steps {
    position: absolute;
    top: 50%;
    // left: 100%;
    right: 10%;
    transform: translateX(-50%);
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    @include clamp-property("gap", 4, 7.5);

    @media screen and (max-width: 480px) {
      right: 5%;
      top: 45%;
    }

    @media screen and (min-width: 481px) and (max-width: 768px) {
      right: 0%;
    }

    @media screen and (min-width: 769px) and (max-width: 1366px) {
      right: 9%;
    }

    @media screen and (min-width: 1367px) and (max-width: 1920px) {
      right: 19%;
    }

    @media screen and (min-width: 1921px) and (max-width: 3840px) {
      right: 26%;
    }

    @media screen and (min-width: 3840px) {
      right: 31%;
    }

    .step {
      display: flex;
      align-items: center;
      @include clamp-property("gap", 1, 2);

      @media screen and (max-width: 480px) {
        flex-direction: column;
      }

      .count {
        display: flex;
        flex-direction: column;
        align-items: center;
      @include clamp-property("font-size", 1, 2);


        @media screen and (min-width: 481px) and (max-width: 768px) {
          row-gap: 2rem;
        }

        img {
          @include clamp-property("margin-bottom", 0, 2.5);
          @include clamp-property("width", 21.875, 29.125);
          @include clamp-property("height", 18.6, 32.765);
          @include clamp-property("border-radius", 1.5, 2);
          object-fit: cover;
        }

        span {
          font-family: $font-gloock;
          background: #e7dfcf;
          width: 60px;
          height: 60px;
          @include flex-center;
          color: rgb(0, 0, 0);
          border-radius: 50%;
        }

        @media screen and (max-width: 480px) {
          span {
            display: none;
          }
        }
      }

      .step-desc {
        width: 310px;

        h3 {
          @include clamp-property("font-size", 1, 2);
          line-height: 120%;
          letter-spacing: -1%;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: #08110b;
        }

        span {
          @include clamp-property("font-size", 0.875, 1);
          line-height: 160%;
          letter-spacing: -1%;
          font-weight: 400;
          color: #5e5e5e;
        }

        @media screen and (max-width: 480px) {
          width: 100%;
          display: flex;
          align-items: center;
          gap: 20px;

          svg {
            width: 40px;
            height: 40px;
            flex-shrink: 0;
          }
        }
      }
    }

    .steps-line {
      width: 100%;
      position: absolute;
      // bottom: 0%;
      top: calc(100% - 30px);

      left: 58%;
      transform: translateX(-50%);
      z-index: -10;

      .back-line {
        background: #e8eaea;
        height: 2px;
        width: 70%;

        .progress {
          background: #7e6b47;
          height: 100%;
          width: 0%;
        }
      }

      @media screen and (max-width: 480px) {
        // top: unset;
        // bottom: -120%;
        top: calc(110% + 20px);

        left: 50%;
        transform: translateX(-50%);

        .back-line {
          width: 100%;
        }
      }
    }

    .steps-line-count {
      width: 100%;
      position: absolute;
      top: calc(105% + 20px);
      left: 50%;
      transform: translateX(-50%);
      z-index: -10;
      display: none;
      justify-content: space-between;

      span {
        font-family: $font-gloock;
        background: #e7dfcf;
        width: 40px;
        height: 40px;
        @include flex-center;
        color: rgb(0, 0, 0);
        border-radius: 50%;
      }

      @media screen and (max-width: 480px) {
        display: flex;
      }


    }
  }
}
</style>
